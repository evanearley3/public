# Powershell script for fixing the very common Tenable plugin #133049

# Uses MS .NET install script to update .NET using commandline arguments to set parameters for install

# You can also specify a version to be removed (ex. -Remove 2.1.13)

# Your options for '-which' are "aspnetcore" or "netcore"

# See this article for more details on additional switches for the official Microsoft dotnet-install.ps1 script that this script uses
# https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-install-script

# -version <version you want to install> ex. 3.0.1
# -which <dotnet package to install> ex. 'aspnetcore'  or 'netcore'>
# -remove <which version you want to remove> Enter the version that appears as vulnerable in Tenable
# ex.) .\dotnet_fix.ps1 -version 3.0.1 -which aspnetcore -remove 3.0.0

param([string] $version, [string] $which, [string] $remove)

# Typical location for x64 dotnet
$path1 = "C:\Program Files\dotnet\shared\Microsoft.AspNetCore.App\"
$path2 = "C:\Program Files\dotnet\shared\Microsoft.NETCore.App\"
$path3 = "C:\Program Files\dotnet\shared\Microsoft.AspNetCore.All\"

./dotnet-install.ps1 -Channel LTS -runtime $which -Version $version -InstallDir 'C:\Program Files\dotnet\'

Start-Sleep -s 7;

Remove-Item -path $path1$remove -Recurse -Force -Verbose;
Remove-Item -path $path2$remove -Recurse -Force -Verbose;
Remove-Item -path $path3$remove -Recurse -Force -Verbose